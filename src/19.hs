import Aoc
import Data.Function
import Data.Vector (Vector, (!))
import qualified Data.Vector as Vec
import Data.Char (isLetter)

input = "                                                                                                                                                   |                                                     \n                         +-+             +-----------------------------+   +---+                                                           +-------+   +-+ +-+                   +-+     +-------+   +-+ \n                         | |             |                             |   |   |                                                           |           | | | |                   | |     |       |   | | \n           +-------------+ |   +-+     +-------------------------------|---|---|---------------------------------------------------------+ |           | | | |                   | |     |     +-+   | | \n           |               |   | |     | |                             |   |   |                                                         | |           | | | |                   | |     |     |     | | \n           |               |   | |     | |                 +-+   +---+ |   |   |         +-------------------------------------------------|-------------+ | |                   | |     |     |     | | \n           |               |   | |     | |                 | |   |   | |   |   |         |                                               | |           |   | |                   | |     |     |     | | \n   +-------|-------------------|-|-+   | |             +---+ I +-|---|-|---+   |         |                   +-------------------------------------------------------------------|-|-----|---+ +-------+ \n   |       |               |   | | |   | |             |       | |   | |       |         |                   |                           | |           |   | |                   | |     |   |       |   \n   |       |               |   +---------|-------------|---------+ +-|---------|---------|-----------+       |                           | |     +---------|-|-------------------------------|-----+ |   \n   |       |               |     | |   | |             |       |   | | |       |         |           |       |                           | |     |     |   | |                   | |     |   |     | |   \n   |       |               |     | | +---|-------------|-------|---|-|-------------+     |           |       |                     +-------|-+   |     |   | +---------------------|-----|---+     | |   \n   |       |               |     | | | | |             |       |   | | |       |   |     |           |       |                     |     | | |   |     |   |                     | |     |         | |   \n   |       |               |     | | | | |             |       |   | | |   +---|---------|-----------|-------|---------------------|-------|-----------|-------------------------|-------|-------+ | |   \n   |       |               |     | | | | |             |       |   | | |   |   |   |     |           |       |                     |     | | |   |     |   |                     | |     |       | | |   \n   |       |               |     | | | | |             | +-----|---|-------|-------|-----|-----------------------------------------|---------|-------+ |   +---------------------|-|-------------|---+   \n   |       |               |     | | | | |             | |     |   | | |   |   |   |     |           |       |                     |     | | |   |   | |                         | |     |       | |     \n   |       |               |     | +-|-|---------------|-|-----|-----|-|---+   |   |     |           |       |                     |     | | |   |   | |       +-------------+   +-------|---+   | |     \n   |       |               |     |   | | |             | |     |   | | |       |   |     |           |       |                     |     | | |   |   | |       |             |     |     |   |   | |     \n +---------------------+ +-------|-----|---------------|-|-----|-----|-|-----------+     |           |       |           +-----------------|-----|-----|---------------------------|-----|-----+ | |     \n | |       |           | | |     |   | | |             | |     |   | | |       |         |           |       |           |         |     | | |   |   | |       |             |     |     |   | | | |     \n | |       |           | | |     |   | | |             | |     | +-|---|-------|---------------------|-------------------|---------|-----|-------|---|-|-------|-----------------------+ |   | | | |     \n | |       |           | | |     |   | | |             | |     | | | | |       |         |           |       |           |         |     | | |   |   | |       |             |     |   | |   | | | |     \n | |       |           | | |     |   | | |         +-----|---+ +-------|-----------------|-----------|-------+           |         | +---|-------------|---------------------|---------|-|-----+ | |     \n | |       |           | | |     |   | | |         |   | |   |   | | | |       |         |           |                   |         | |   | | |   |   | |       |             |     |   | |   |   | |     \n | | +-+ +-|-----------|-------------|-|-|---------------------+ | | +-|-----------------|-----------|---+     +---------|---------------|-|-|-----------------|-------------|-----|-----|---|---------+ \n | | | | | |           | | |     |   | | |         |   | |   | | | |   |       |         |           |   |     |         |         | |   | | |   |   | |       |             |     |   | |   |   | |   | \n | | | | | |           | | |     |   | | |         | +-|-|-+ | | | |   |       |         |           |   | +---|-----+   |         | |   | | |   |   | |       |       +-----|-----|-----|---+   | |   | \n | | | | | |           | | |     |   | | |         | | | | | | | | |   |       |         |           |   | |   |     |   |         | |   | | |   |   | |       |       |     |     |   | |       | |   | \n | | | | | +---+       | | |     |   | | |         +-|---|---|-|-----+ |   +-------------|-----------|---+ |   |     |   |         | |   | | |   |   | |       | +-----------------------|-+     | |   | \n | | | | |     |       | | |     |   | | |           | | | | | | | | | |   |   |         |           |     |   |     |   |         | |   | | |   |   | |       | |     |     |     |   | | |     | |   | \n | | | | |     |       | | |     |   | | |           | | | | | | | | | |   |   |         |   +---------------------------------------|---|---|---|---------------------|-------------------+     | |   | \n | | | | |     |       | | |     |   | | |           | | | | | | | | | |   |   |         |   |       |     |   |     |   |         | |   | | |   |   | |       | |     |     |     |   | |       | |   | \n | | | | |     |       | | |     |   | | |           | | | | | | | | | |   |   |         |   |       +-----|-+ |   +-----|-----------|---|-|-|-------------+ +---|-+   |     |     | +-----+     | |   | \n | | | | |     |       | | |     |   | | |           | | | | | | | | | |   |   |         |   |             | | |   | |   |         | |   | | |   |   | |   | | | | |   |     |     | | | | |     | |   | \n | | | | |     |       | | |     |   | | |           | | +-|-|-|---+ | |   |   |         |   |             | | |   | +-------------|-----------------|-|---|-|-|---|---------------|-|-|-|-----+ | |   | \n | | | | |     |       | | |     |   | | |           | |   | | | |   | |   |   |         |   |             | | |   |     |         | |   | | |   |   | |   | | | | |   |     |     | | | | |   | | |   | \n | | | | |     +---------|-|-----|-+ | | |           | |   | | | |   +-------------------|----------------------C--|---------------+ |   | | |   |   | |   | | +-------|-----|-----+ | | | |   | | |   | \n | | | | |             | | |     | | | | |           | |   | | | |     |   |   |         |   |             | | |   |     |           |   | | |   |   | |   | |   | |   |     |       | | | |   | | |   | \n | | | +-----------------|-------|-|---|-|-----------|-----|-|-|-|-----|-----------------|---|---------------------|-----|-----------|-------|-------|-----------|-----------|-----+ | | | | +-|-+ |   | \n | | |   |             | | |     | | | | |           | |   | | | |     |   |   |         |   |             | | |   |     |           |   | | |   |   | |   | |   | |   |     |     | | | | | | |   |   | \n | | |   |             | | |     | | | | |           | |   | | | |     |   |   |         |   |             | | |   |     |           |   | | |   |   | |   | |   | |   |     |     | +-|---|-+ |   |   | \n | | |   |             | | |     | | | | |           | |   | | | |     |   |   |         |   |             | | |   |     |           |   | | |   |   | |   | |   | |   |     |     |   | | |   |   |   | \n | | |   |             | | |     | | | +---------------------|---|---------|---------+   |   |             | | +---+     |           |   | | |   |   | |   | |   +-|-----------------+ | | | +-------+ | \n | | |   |             | | |     | | |   |           | |   | | | |     |   |   |     |   |   |             | |           |           |   | | |   |   | |   | |     |   |     |     | | | | | | |   | | | \n | | |   |             | | |     | | |   |           | |   | | | |     |   |   |     |   |   |             | |           |           |   | | |   |   | |   | |   +-|---------|-----|-|---+ | | |   | | | \n | | |   |             | | |     | | |   |           | |   | | | |     |   |   |     |   |   |             | |           |           |   | | |   |   | |   | |   | |   |     |     | | |   | | |   | | | \n | | |   |             | | |     | | |   |           | |   | | | | +---|---|-+ |     |   | +---+           | |           |           |   | | |   +-----|-----|---|-|-----------------|-----|---+   | | | \n | | |   |             | | |     | | |   |           | |   | | | | |   |   | | |     |   | | | |           | |           |           |   | | |       | |   | |   | |   |     |     | | |   | |     | | | \n | | |   |             | | |     | | |   |           +-|---|-------+   |   | | |     |   | | | |           | |           |           |   | | |       | |   | |   | |   |     |   +-|-|---------+   | | | \n | | |   |             | | |     | | |   |             |   | | | |     |   | | |     |   | | | |           | |           |           |   | | |       | |   | |   | |   |     |   | | | |   | | |   | | | \n | | |   |           +-|-----+   | | |   |             |   | | | |     |   | | |     |   | | | |           | |           |           |   | | |       | |   | +---|-|---|-----|---|-|-+ |   | | |   | | | \n | | |   |           | | | | |   | | |   |             |   | | | |     |   | | |     |   | | | |           | |           |           |   | | |       | |   |     | |   |     |   | |   |   | | |   | | | \n | | |   |           | | | | |   | | |   |     +-----+ +---------|---+ |   | | |     |   | | | |           | |           |           |   | | |       | |   |   +-|---+ |   +-----|---+ |   | | |   | | | \n | | |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |           |   | | |       | |   |   | | | | |   | |   | | | |   | | |   | | | \n | | |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |           |   | | |       | |   |   | | | | |   | |   | | | |   | | +-+ | | | \n | | |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |           |   | | |       | |   |   | | | | |   | |   | | | |   | |   | | | | \n +-+ |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |           |   | | |       | +---------|-|---------------------------+ | | | | \n     |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |           |   | | |       |     |   | | | | |   | |   | | | |   | | | | | | | \n     |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |     +-----------|-----------------------|---------------|-|-----|-----|-|-|-+ \n     |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |     |     |   | | |       |     |   | | | | |   | |   | | | |   | | | | | |   \n     |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |     |     |   | | |       |     |   | | | | |   | |   | | | | +-|---|-|-+ |   \n     |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |     |     |   | | |       |     |   | | | | |   | |   | | | | | | | | |   |   \n     |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |     +-----|-------------|-----|-----|-----|---------|---------|-|-|-|-------|-----|-+ | | | | | |   |   \n     |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |     |     | |           |     |     |   | | |       |     |   | | | | |   | |   | |   | | | | | |   |   \n     |   |         +-------|-----|---|---|-----|-----|-----------|---|-|---|-|-|-----|-----|---------------|-|-----------|-----|-----|-----|---------|-----|-----|-|-|-----|-|-----|---|-|-------+   |   \n     |   |         | | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |     |     | |           |     |     |   | | |       |     |   | | | | |   | |   | |   | | | | |     |   \n     |   |         | +-|---|---------|---|-------------------|-|-|---|-|---|-|-----------------|-----------|-|-----------|-----|-----|---------------------|-----------|---------|-----|---|---------|-+ \n     |   |         |   | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |     |     | |           |     |     |   | | |       |     |   | | | | |   | |   | |   | | | | |     | | \n     |   |         +---|---------|---|---|-----------|-----------------|---|---|------L----|-|-------+     | |           |     |     |   | | |       |     |   | +-|-|-|---|-|---|-----|-|---+ | +---+ | \n     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |     |     |   | | |       |     |   |   | | |   | |   | |   | | |   | |     | \n     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |     |     |   | | | +---------------------|-|-----|-----------|-------|---+ | \n     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |     |     |   | | | |     |     |   |   | | |   | |   | |   | | |   | |   | | \n     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | +-|-----------|-|---+       | +-------------|-----------------|---|-----|-|---|-|-----|---|-|---+ | |   | | \n     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | |   |           | |   |       | |   |     |   | | | |     |     |   |   | | |   | |   | |   | | | | | |   | | \n     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | |   +-------------|---|-------|-----|---------|---|-|-----|-----------+ | | | +-|-------|-------|-----|---+ | \n     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | |               | |   |       | |   |     |   | | | |     |     |   | | | | | | | |   | |   | | | | | |     | \n     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | |               | |   |       | |   |   +-------|-|-------------|---|-+ | | | | | |   | |   | | | | | |     | \n     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | |               | |   |       | |   |   | |   | | | |     |     |   |   | | | X | |   | |   | | | | | |     | \n     |   |             | | | +---|-------|-----------------|---|-|-------------------|---------+           +-----|-------------|-----|-----|-----------------------|-|-------|---|-|---|-|-|-|-------+ | \n     |   |             | | |     | | |   |     |     |     | | | |   | |   | | |     |   | |   |             |   |       | |   |   | |   | | | |     |     |   |   | | | | | |   | |   | | | | | |   | | \n   +--B--|---------+   | | |     | | |   |     |     |     | | | |   | |   | | |     |   | |   |           +-|-----------|---+ |   | |   | | | |     |     |   | +-|---|---------+ |   | | | | | |   | | \n   | |   |         |   | | |     | | |   |     |     |     | | | |   | |   | | |     |   | |   |           | |   |       | | | |   | |   | | | |     |     |   | | | | | | | |     |   | | | | | |   | | \n   | |   |         +---|-|-----------|---------|-------------|-------|-----|-|-|-----|---|-----------------------|-------|-|-------|-|-----|---|-----|-----|---|-----|-----|-|-----|---+ | +-|-|-|---+ | \n   | |   |             | | |     | | |   |     |     |     | | | |   | |   | | |     |   | |   |           | |   |       | | | |   | |   | | | |     |     |   | | | | | | | |     |     |   | | |     | \n   | |   |             | | |     | | |   |     |     |     | | | |   | |   | | |     |   | |   |           +-----------------------|-------|-|-|---------------|-------|-|-------+ |     |   | | | +-+ | \n   | |   |             | | |     | | |   |     |     |     | | | |   | |   | | |     |   | |   |             |   |       | | | |   | |   | | | |     |     |   | | | | | | | |   | |     |   | | | | | | \n   | |   |             | | |     | | |   |     |     |     | | | |   | |   | | |     |   | |   |             |   |       | | | |   | |   | | | |     |     |   | | | | | | | |   | |     |   | | | | | | \n   | |   |             | | |     | | |   |     |     |     | | | |   | |   | | |     |   | |   |             |   |       | | | |   | |   | | | |     |     |   | | | | | | | |   | |     |   | | | | | | \n   | |   |             | | |     | | |   |     |     |     | | | |   +-----|-|-----------|-|---|-------------|---|-------|-----|---|-|---|-----|---------------|-----|-|-|-------|-|-------+ | | | | | | \n   | |   |             | | |     | | |   |     |     |     | | | |     |   | | |     |   | |   |             |   |       | | | |   | |   | | | |     |     |   | | | | | | | |   | |     | | | | | | | | \n   | |   +-------------|-|-|---------|---+     |     |     | | | |     |   | | |     |   | | +-|-----------------|-------+ | | |   | |   | | | |     |     |   | | +---|---------|-----+ | | | | | | | | \n   | |                 | | |     | | |         |     |     | | | |     |   | | |     |   | | | |             |   |         | | |   | |   | | | |     |     |   | |   | | | | |   | |   | | | | | | | | | \n   | |             +---|-|-|---------|---------------------|---|-------|-----|-|-----|---+ +---|-------------|---|-------------------------|-|-|-----------|---|---------|-|-|---|-|---|---+ | | | | | | \n   | |             |   | | |     | | |         |     |     | | | |     |   | | |     |       | |             |   |         | | |   | |   | | | |     |     |   | |   | | | | |   | |   | |   | | | | | | \n   | |             |   | | |     | | |         |     |     | | | |     |   | | |     |       | |         +---|---------------------------------------|---------|-|---|-|---|-----|-----------|-|-----+ | \n   | |             |   | | |     | | |         |     |     | | | |     |   | | |     |       | |         |   |   |         | | |   | |   | | | |     |     |   | |   | | | | |   | |   | |   | | | |   | \n   | |             |   +-|-|-----|-|-----------|-------------|-|-|---------|---|-----|-------|-----------|---|-------------+ | |   | |   | | | |     |     |   | +-----|-|---+   | | +-|-|-+ | | | |   | \n   | |             |     | |     | | |         |     |     | | | |     |   | | |     |       | |         |   |   |           | |   | |   | | | |     |     |   |     | | | |     | | | | | | | | | |   | \n   | |             |     | |     | | |         |     |     | | | |     |   | | |     |       | |         |   |   |           | |   | |   | | | |     |     |   |     | | | |     | | | | | | | | | |   | \n   | |             |     | |     | | |         |     |     | | | |     |   | | |     |       | |         |   |   |           | |   | |   | | | |     |     |   |     | | | |     | | | | | | | | | |   | \n   | |           +-------|-|-------|-------------------------|---------|---|---------------------------------|---------------------|-|---|-|---|-----|-----|-------------|-|-----|-|-|---|---+ | | |   | \n   | |           | |     | |     | | |         |     |     | | | |     |   | | |     |       | |         |   |   |           | |   | |   | | | |     |     |   |     | | | |     | | | | | |   | | |   | \n   | |           | |     | |     | | |         |     |     | | | |     |   | | |   +---------------------|---|-----------------|---------|-|---|---------------|---------|-------|---|---|-----------+ | \n   | |           P |     | |     | | |         |     |     | | | |     |   | | |   | |       | |         |   |   |           | |   | |   | | | |     |     |   |     | | | |     | | | | | |   | | | | | \n   | |           | |     | |     | | | +-------------|-----|---|-|-----+   | | |   | |       | |         |   |   |           | |   | |   | | | |     |     |   |     | | | +-----|-|-|-|---|---|---+ | | \n   | |           | |     | |     | | | |       |     |     | | | |         | | |   | |       | |         |   |   |           | |   | |   | | | |     |     |   |     | | |       | | | | | |   | |   | | \n   | |           | |     | |     | | | | +-----|-----|-------|---|-----------------|-------------------------|---------------|-|---|-------|---|-----|---------|-+   | | | +-----|-|-|---|---------+ | | \n   | |           | |     | |     | | | | |     |     |     | | | |         | | |   | |       | |         |   |   |           | |   | |   | | | |     |     |   | |   | | | |     | | | | | |   | | | | | \n   | |           | |     | |     | | | | |     |     |     | | | |         | | |   | |       | |         |   |   |           | |   | |   | | | |     |     |   | |   | | | |     | | +-|-|-----|---+ | | \n   | |           | |     | |     | | | | |     |     |     | | | |         | | |   | |       | |         |   |   |           | |   | |   | | | |     |     |   | |   | | | |     | |   | | |   | |   | | \n   | |           | |     | +---------|---+     | +---|-----|---|-|-------------|-----|-------|-|---------|---+   |       +-----|-----|-----|-|-|-------------+ | +---------|-------|---|-|-|-----|-+ | | \n   | |           | |     |       | | | |       | |   |     | | | |         | | |   | |       | |         |       |       |   | |   | |   | | | |     |     | | |     | | | |     | |   | | |   | | | | | \n   | |           | |     |       | | | |       +-+   |     | | | | +---------|-----|-|-------|-|-----+   |       |       |   | |   | |   | | | |     |     | | |     | | | |     | |   | | |   | | | | | \n   | |           | |     |       | | | |             |     | | | | |       | | |   | |       | |     |   |       |       |   | |   | |   | | | |     |     | | |     | | | |     | |   | | |   | | | | | \n   | |           | |     |       | | | |             |     | | | | |       | | |   | |       | |     +-----------|-----------|-----|-----|---|-|-----|---------|-----|-|-|-------|-|-+ | | |   | | | | | \n   | |           | |     |       | | | |             |     | | | | |       | | |   | |       | |         |       |       |   | |   | |   | | | |     |     | | |     | | | |     | | | | | |   | | | | | \n   | |           | |     |       | | | |             |     | | | | |       | | |   | |       | |         | +-------------------|-----|---|-|-|-------------|-----------|---|-----|---+ | | |   | | | | | \n   | |           | |     |       | | | |             |     | | | | |       | | |   | |       | |         | |     |       |   | |   | |   | | | |     |     | | |     | | | |     | |   | | |   | | | | | \n   +-|-------------------|---------|-|---------------|-----|-|-----|-------|-|-|-----+       | |         | |     |       |   | |   | |   | | | |     |     | | |     | | | |     | |   | | |   | | | | | \n     |           | |     |       | | | |             |     | | | | |       | | |   |         | |         | |     |       |   | |   | |   | | | |     |     | | |     | | | |     | |   | | |   | | | | | \n     |           | |     |       | | | |             |     | | | | |       | | |   |     +-----|------H------+   |       |   | |   | |   | | | |   +-|-----|---|-+   | | | +-+   | |   | | |   | | | | | \n     |           | |     |       | | | |             |     | | | | |       | | |   |     |   | |         | | |   |       |   | |   | |   | | | |   | |     | | | |   | | |   |   | |   | | |   | | | | | \n     |           | |     |       | | | |             |     | | | | |       | | |   |     |   | |         | | |   |       |   | |   | |   | | | |   | |     +-----|---|---------+ | |   +-|-+   | | | | | \n     |           | |     |       | | | |             |     | | | | |       | | |   |     |   | |         | | |   |       |   | |   | |   | | | |   | |       | | |   | | |   | | | |     |     | | | | | \n     |       +-----|-----|---------+ | |             |     | | | | |       | | |   |     |   | |         | | |   | +---------------|-----|-|---|-------------|---|-----|-|-----|-----------------+ | | | \n     |       |   | |     |       |   | |             |     | | | | |       | | |   |     |   | |         | | |   | |     |   | |   | |   | | | |   | |       | | |   | | |   | | | |     |     |   | | | \n     |       |   | |     |       |   | |             |     | | | | |       | | |   |     |   | |         | | |   | |     |   | |   | |   | | | |   | |       | | |   | | |   | | | |     |     |   | | | \n     |       |   | |     |       |   | V             |     | | | | |       | | |   |     |   | |         | | |   | |     |   | |   | |   | | | |   | |       | | |   | | |   | | | |     |     |   | | | \n   +-|-------------|-------+     |   | |             |     | | | | |       | | |   |     |   | |         | | |   | +---------------|-------|-+ |   | |       | | |   | | |   | | | |     |     |   | | | \n   | |       |   | |     | |     |   | |             |     | | | | |       | | |   |     |   | |         | | |   |       |   | |   | |   | |   |   | |       | | |   | | |   | | | |     |     |   | | | \n   | |       |   | |     | |     |   | |             |     | | | | |       | | |   |     | +-------------+ | |   |       |   | |   | |   | |   |   | |       | | |   | | |   | | | |     |     |   | | | \n   | |       |   | |     | |     |   | |             |     | | | | |       | | |   |     | | | |           | |   |       |   | |   | |   | |   |   | |       | | |   | | |   | | | |     |     |   | | | \n +-+ |       |   | |     | |     |   | +-------------|-------|---|-------+ | | |   |   +---|-|-|-----------|-|-------+   |   | |   | |   | |   |   | |       | | |   | | |   | | | |     |     |   | | | \n |   |       |   | |     | |     |   |               |     | | | | |     | | | |   |   | | | | |           | |   |   |   |   | |   | |   | |   |   | |       | | |   | | |   | | | |     |     |   | | | \n |   |     +-----|-|-------------|---|---------------|-------|---|-------|---|-----|---|---------------------|---|---|-------------------|-----|---|-|-------|-------|-------|-+ | |     |     |   | | | \n |   |     | |   | |     | |     |   |               |     | | | | |     | | | |   |   | | | | |           | |   |   |   |   | |   | |   | |   |   | |       | | |   | | |   |   | |     |     |   | | | \n |   |     | |   | |     | | +---|-------------------|---------+ | |     | | | |   |   +---+ | |         +-|-+   |   |   |   | |   | |   | |   |   | |   +---|---------|-|-----+ | |   +---------+ | | | \n |   |     | |   | |     | | |   |   |               |     | |   | |     | | | |   |     |   | |         | |     |   |   |   | |   | |   | |   |   | |   |   | | |   | | |   | | | |   | |     | | | | | \n |   |     | |   | | +-------|-------------------+   +---------+ | | +-----|---|---|-+   |   | |         | |     |   |   |   | | +---------|---|---------|---|-+ |   | | |   | | | +-+ | |     | | | | | \n |   |     | |   | | |   | | |   |   |           |         | | | | | |   | | | |   | |   |   | |         | |     |   |   |   | | | | |   | |   |   | |   |   |   |   | | |   | | |   | | |     | | | | | \n |   |     | |   | +-|-------|---|---+           +---------|-------------|-|-|-|-----|---|---|-|---------+ +-----|-----------------------------------|-----------|---|---|---|-|-------|-+     | | | | | \n |   |     | |   |   |   | | |   |                         | | | | | |   | | | |   | |   |   | |                 |   |   |   | | | | |   | |   |   | |   |   T   |   | | |   | | |   | |       | | | | | \n +---|-----|-|-------|-------|---------------------------------|---|---------|-|-----|---|-----------------------|---------------|-|-----|---+ |   | |   |   |   |   | | |   | | +-+ | |   +-+ | | | | | \n     |     | |   |   |   | | |   |                         | | | | | |   | | | |   | |   |   | |                 |   |   |   | | | | |   | | | |   | |   |   |   |   | | |   | |   | | |   | | | | | | | \n     |     | |   |   |   | | |   |                         +-----|-|-|-----|---|---------|---|-----------------------|-------|-|-----------|-|-|----------E------|-------|---|---+ | | |   | | | | | | | \n     |     | |   |   |   | | |   |                           | | | | |   | | | |   | |   |   | |                 |   |   |   | | | | |   | | | |   | |   |   |   |   | | |   | | | | | |   | | | | | | | \n     |     | +-------|-----------|---------------------------|-|-|---|---|-----------|---|-----+                 |   |   |   | | | | |   | | | |   | +---|-----------|---------|---+ | |   | | | | | | | \n     |     |     |   |   | | |   |                           | | | | |   | | | |   | |   |   |                   |   |   |   | | | | |   | | | |   |     |   |   |   | | |   | | |   | |   | | | | | | | \n     |     |     |   |   +-|-|-------------------------------|-|-|-------|-|---|---------|---------------+       |   +---------------|---|---------|---------------------|---+ | |   | | +-+ | | | | | | \n     |     |     |   |     | |   |                           | | | | |   | | | |   | |   |   |           |       |       |   | | | | |   | | | |   |     |   |   |   | | |     | |   | | |   | | | | | | \n     |     |     |   |     | | +---------------------------------|-|-|---|---|-|---|-|-------|-----------|-------|-----------|---|-------------|---|-----|---|---|-----|-|-------|---+ | +-+ | | | | | | \n     |     |     |   |     | | | |                           | | | | |   | | | |   | |   |   |           |       |       |   | | | | |   | | | |   |     |   |   |   | | |     | |     |   | | | | | | | \n     +-----+ +-----+ |     | | | |                           | | | | |   | | | |   | |   |   |       +---|-+     |       |   | | | | +-----|-------|---------|-----------|-----+ |     +---|-+ | | | | | \n             |   | | |     | | | |                           | | | | |   | | | |   | |   |   |       |   | |     |       |   | | | |     | | | |   |     |   |   |   | | |       |         |   | | | | | \n +---------------------------|---+                           | | | | |   | | | |   | +-------|-------|-----------|-------|---|-----------|-|---------------------|-----|-|---+   | +-------|-+ | | | | | \n |           |   | | |     | | |                             | | | | |   | | | |   |     |   |       |   | |     |       |   | | | |     | | | |   |     |   |   |   | | |   |   | |       | | | | | | | \n |           |   | | |     | | |                             | | | | |   | | | |   | +---|-----------|---|-|-----|-------|---|-|-----+   | | +-|---------|---|---------|-|---|-+ | |       +-+ | | | | | \n |           |   | | |     | | |                             | | | | |   | | | |   | |   |   |       |   | |     |       |   | | | | |   | |   |   |     |   |   |   | | |   | | | |           | | | | | \n +-----------|-----|-------|---|---------------------------------|-------|---|-------|---------------|-----------|---+   |   | | | | |   | |   |   +-----|-+ |   |   | | |   | | | |           | | | | | \n             |   | | |     | | |                             | | | | |   | | | |   | |   |   |       |   | |     |   |   |   | | | | |   | |   |         | | |   |   | | |   | | | |           | | | | | \n +---------------|-|-|---------|-----------------------------|-----|-|-------|-|---|-|---|---|-------|---------------|-------|---|-|-|---------|---+     | | |   |   | | |   | | | |           | | | | | \n |           |   | | |     | | |                             | | | | |   | | | |   | |   |   |       |   | |     |   |   |   | | | | |   | |   |   |     | | |   |   | | |   | | | |           | | | | | \n |           |   | | |   +-|---|-+ +-------------------------------+ |   | | | |   +-----|---|-------|---------------|-------|-------|---+ |   |   | +-----|-|---|-----------|-|---------------|---+ | | \n |           |   | | |   | | | | | |                         | | |   |   | | | |     |   |   |       |   | |     |   |   |   | | | | |     |   |   | |   | | |   |   | | |   | | | |           | |   | | \n +-----------|-----|-|---|-|---|-|---+                       | | |   |   | | | |     |   |   |       |   | |     +---|---|---|-|-|-+ |     |   |   | | +---|---------|-|-----|-|---|---+ +-----|---+ | | \n             |   | | |   | | | | | | |                       | | |   |   | | | |     |   |   |       |   | |         |   |   | | |   |     |   |   | | | | | |   |   | | |   | | | |   | |     | | | | | \n             |   | | |   | | | | | | |       +---------------|---|-------|---|-|-----|---|-----------|---|-|---------|-------|-|-|---+     |   |   +---+ | | |   | +-+ | +---|-------------+   | | | | | \n             |   | | |   | | | | | | |       |               | | |   |   | | | |     |   |   |       |   | |         |   |   | | |         |   |     |   | | |   | |   |     | | | |   | | |   | | | | | \n             |   | | |   | | | | | | |       |               | | |   |   | | | |     |   |   |       |   | +-------+ +-------|-----------------------------|---+ +-|-----------|-------+ | |   | | | | | \n             |   | | |   | | | | | | |       |               | | |   |   | | | |     |   |   |       |   |         |     |   | | |         |   |     |   | | | |   |   |     | | | |     | |   | | | | | \n +---+       |   | +-----|---------|---------|---------------|-------|-----|-+ |     |   |   |       |   +---------|-----|-------|-------------|---------|-|-----------|-----|---+ |   +-|-+   | | | | | \n |   |       |   |   |   | | | | | | |       |               | | |   |   | |   |     |   |   |       |             |     |   | | |         |   |     |   | | | |   |   |     | |   |   | |     | | | | | \n +---|-----+ |   |   |   | | | | | | |       |               | | |   |   +-|---|-----|---|-----------|-------+     +-----|---|-----------------|-----|-------|-|---------------|-------|---+   | | | | | \n     |     | |   |   |   | | | | | | |       |               | | |   |     |   |     |   |   |       |       |           |   | | |         |   |     |   | | | |   |   |     | |   |   | | |   | | | | | \n     |     | |   |   +---|---|-|-----|---+   |               | | |   |     +---------|---|-------------------------------------|-|-------------------------|-|---+ |   |     | | +-------|-|-------+ | | \n     |     | |   |       | | | | | | |   |   |               | | |   |         |     |   |   |       |       |           |   | | |         |   |     |   | | | | | |   |     | | | |   | | |   | |   | | \n     |     | |   |       | | | | | | |   |   |               | | |   |         |   +---------|---------------|-----------|---|-------------|---------------|-----|-----------|---------+ | +-+ | |   | | \n     |     | |   |       | | | | | | |   |   |               | | |   |         |   | |   |   |       |       |           |   | | |         |   |     |   | | | | | |   |     | | | |     |   | | |   | | \n     +-----|-----|---------+ | | | | +---+   |               | | +-----------------------|-----------------+ |           |   | | |         |   |     |   | | | | | +---------|---+ +-----|-+ | | |   | | \n           | |   |       |   | | | |         |               | |     |         |   | |   |   |       |     | |           |   | | |         |   |     |   | | | | |     |     | |         | | | | |   | | \n           | +---|-------|---|-+ | | +-------|---------------|-----------------------|---|---|-------------|-|-----------+   | | |         | +-------|---|-|-+ | | +---|-----|-----------|---|---+   | | \n           |     |       |   |   | | |       |               | |     |         |   | |   |   |       |     | |               | | |         | | |     |   | |   | | |   |     | |         | | | |     | | \n           |     |       |   |   | | |       |               | |     |         |   | |   |   |     +-|-----------------------+ | +-----------|---------------+ | | | +-|-----|-|-------+ | | | |     | | \n           |     |       |   |   | | |       |               | |     |         |   | |   |   |     | |     | |                 |           | | |     |   | | | | | | | |     | |       | | | | |     | | \n           +-----|-----------|-------|-------|---------------|-------|-------------+ |   +---+     +-|-----|-------------------|-------------|-|-----|---+ +-+ | | | | |     | | +---+ +-+ | | +---+ | | \n                 |       |   |   | | |       |               | |     |         |     |               |     | |                 |           | | |     |         | | | | |     | | |   |     | |     | | | \n                 |       |   +---+ | |       |               | |     |         |     +---------------|-----|-----------------------------------------|---------+ | | | +-------|-----------+ |     | | | \n                 |       |         | |       |               | |     |         |                     |     | |                 |           | | |     |           | | |       | | |   |       |     | | | \n                 |       +-----------|-------|---------------|-|-----|-------------------------------------|-------------------|-----------+ | +-----+ +-----------------------+ |   |       |     | | | \n                 |                 | |       |               | |     |         |                     |     | |                 |             |         |         | | |       |   |   |       |     | | | \n                 |                 +---------------------------|-----|-------------------------------|-------|-----------------|-------------+         +-------------|-------------+ +-------|---+ | | | \n                 |                   |       |               | |     |         |                     |     | |                 |                                 | | |       |   | |         |   | | | | \n                 +-------------------|-----------------------|-|-----|---------------------------------------------+ +---------|---------------------------+     | | |       +---|-+         |   | | | | \n                                     |       |               | |     |         |                     |     | |     | |         |                           |     | | |           |           |   | | | | \n                                     +-------+               +-+     +---------+                     +-------------+ +---------|---------------------------|-----|---------------|-----------+   +---|-+ \n                                                                                                           | |                 |                           |     | | |           |                 | |   \n                                                                     +-------------------------------------+ +-----------------+                           +-----|-------------------------------+ | |   \n                                                                     |                                                                                           | | |           |               | | |   \n                                                                     +-------------------------------------------------------------------------------------------+ +-+           +---------------+ +-+   "

turn :: Vector (Vector Char) -> (Int,Int) -> (Int,Int) -> (Int,Int)
turn grid (x,y) (_,0) = if y > 0 && grid!x!(y-1) == '-' then (0,-1) else (0,1)
turn grid (x,y) (0,_) = if x > 0 && grid!(x-1)!y == '|' then (-1,0) else (1,0)

walk :: Vector (Vector Char) -> String -> Int -> (Int,Int) -> (Int,Int) -> (String,Int)
walk grid seen steps (x,y) (dx,dy) = case grid!x!y of
  ' ' -> (reverse seen, steps)
  '+' ->
    let (dx', dy') = turn grid (x,y) (dx,dy) in
    walk grid seen (steps+1) (x+dx', y+dy') (dx', dy')
  c ->
    let seen' = if isLetter c then c:seen else seen in
    walk grid seen' (steps+1) (x+dx,y+dy) (dx,dy)

solveParts :: Int -> (String,Int)
solveParts _ = walk grid "" 0 (0,147) (1,0)
  where grid = lines input & map Vec.fromList & Vec.fromList

main = Aoc.timer solveParts
